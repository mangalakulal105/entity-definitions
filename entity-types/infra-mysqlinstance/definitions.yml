domain: INFRA
type: MYSQLINSTANCE

synthesis:
  rules:
    # based on the OTEL semantic convention for MySQL https://github.com/open-telemetry/semantic-conventions/blob/main/docs/database/sql.md#example
    - identifier: db.system
      name: db.system
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mysql. #check for the potential conflict with existing NR `mysql.node` from OHI
        - attribute: instrumentation.provider
          value: opentelemetry
        # This filters only metrics coming from mysqlreceiver , given that metrics
        # could differ between different runtime receivers.
        - attribute: otel.library.name
          value: otelcol/mysqlreceiver
      tags:
        otel.library.name:
          entityTagName: instrumentation.name
        server.address:
        server.port:


  tags:
    # For OpenTelemetry
    telemetry.sdk.name:
      entityTagName: instrumentation.provider

dashboardTemplates:
  # This should match the entity created from the ohi in the infra pipeline
  newRelic:
    template: newrelic_dashboard.json

goldenTags:
  - mysql.instance.endpoint #As per OTEL spec/metadata.yaml
  - mysql.version
  - mysql.edition
  - mysql.hostname
  # Open Telemetry
  - server.address
  - server.port
  
configuration:
  entityExpirationTime: DAILY
  alertable: true